"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5705],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=o,h=u["".concat(s,".").concat(d)]||u[d]||m[d]||r;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},94159:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return u}});var a=n(87462),o=n(63366),r=(n(67294),n(3905)),i=["components"],l={id:"13-deploy",title:"Deploying a Node.js Application"},s=void 0,p={unversionedId:"13-deploy",id:"13-deploy",title:"Deploying a Node.js Application",description:"Deploying to Heroku",source:"@site/../docs/13-deploy.md",sourceDirName:".",slug:"/13-deploy",permalink:"/node_comit/docs/13-deploy",draft:!1,editUrl:"https://github.com/prma85/node_comit/edit/master/../docs/13-deploy.md",tags:[],version:"current",lastUpdatedBy:"Paulo Andrade",lastUpdatedAt:1580851092,formattedLastUpdatedAt:"Feb 4, 2020",sidebarPosition:13,frontMatter:{id:"13-deploy",title:"Deploying a Node.js Application"},sidebar:"course",previous:{title:"MongoDB & Mongoose",permalink:"/node_comit/docs/12-mongodb"},next:{title:"Debugging & Troubleshooting",permalink:"/node_comit/docs/14-debug"}},c={},u=[{value:"Deploying to Heroku",id:"deploying-to-heroku",level:2},{value:"Setting up the MongoDB database",id:"setting-up-the-mongodb-database",level:2},{value:"Resources",id:"resources",level:2}],m={toc:u},d="wrapper";function h(e){var t=e.components,l=(0,o.Z)(e,i);return(0,r.kt)(d,(0,a.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"deploying-to-heroku"},"Deploying to Heroku"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To deploy your Node.js app you can use ",(0,r.kt)("a",{parentName:"p",href:"https://heroku.com"},"Heroku")," as hosting")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"From the site: ",(0,r.kt)("inlineCode",{parentName:"p"},"Heroku is a fully managed container-based cloud platform, with integrated data services and a powerful ecosystem, for deploying and running modern apps"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Let's get started with installing the Heroku Command Line Interface (CLI)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Windows",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://devcenter.heroku.com/articles/getting-started-with-nodejs#set-up"},"Download the installer")))),(0,r.kt)("li",{parentName:"ul"},"MacOS",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"brew install heroku/brew/heroku\n"))),(0,r.kt)("li",{parentName:"ul"},"Ubuntu 16+",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo snap install heroku --classic\n"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"heroku login")," command to log in to the Heroku CLI:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"heroku login\nheroku: Press any key to open up the browser to login or q to exit\n\u203a   Warning: If browser does not open, visit\n\u203a   https://cli-auth.heroku.com/auth/browser/***\nheroku: Waiting for login...\nLogging in... done\nLogged in as me@example.com\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Let's create a new node package"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd node-example\nnpm init\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Next install express"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install express --save\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"For Heroku, it is important to specify the version of node to match your version ",(0,r.kt)("inlineCode",{parentName:"p"},"node --version"),", edit the ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," to set the engine version."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "node-example",\n  "version": "1.0.0",\n  "description": "",\n  "main": "index.js",\n  "scripts": {\n    "test": "echo \\"Error: no test specified\\" && exit 1"\n  },\n  "keywords": [],\n  "author": "",\n  "license": "ISC",\n  "dependencies": {\n    "express": "^4.17.1"\n  },\n  "engines": {\n    "node": "10.x"\n  }\n}\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Specify the start script in ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "scripts": {\n    "test": "echo \\"Error: no test specified\\" && exit 1",\n    "start": "node index.js"\n  }\n}\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Next lets update the ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," to include a basic express app. Note that we are passing the ",(0,r.kt)("a",{parentName:"p",href:"https://nodejs.org/dist/latest-v8.x/docs/api/process.html#process_process_env"},"environment variable")," PORT to our app."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const express = require("express");\nconst port = process.env.PORT;\nconst app = express();\n\napp.get("/", (request, response) => {\n  response.send("Hello Heroku World!");\n});\n\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`);\n});\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Build and run your application locally"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install\nheroku local\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"After you commit your changes to git, you can deploy your app to Heroku."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'git init\ngit add .\ngit commit -m "Added a Procfile."\nheroku login\nEnter your Heroku credentials.\n...\nheroku create\nCreating arcane-lowlands-8408... done, stack is cedar\nhttp://arcane-lowlands-8408.herokuapp.com/ | git@heroku.com:arcane-lowlands-8408.git\nGit remote heroku added\ngit push heroku master\n...\n-----\x3e Node.js app detected\n...\n-----\x3e Launching... done\n      http://arcane-lowlands-8408.herokuapp.com deployed to Heroku\n\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To open the app in your browser, type ",(0,r.kt)("inlineCode",{parentName:"p"},"heroku open"),"."))),(0,r.kt)("h2",{id:"setting-up-the-mongodb-database"},"Setting up the MongoDB database"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For our course and development, we will leverage ",(0,r.kt)("a",{parentName:"li",href:"https://www.mongodb.com/cloud/atlas"},"MongoDB Atlas")," free cloud-hosted sandbox database. This database tier is not considered suitable for production websites because it has no redundancy, but it is great for development and prototyping."),(0,r.kt)("li",{parentName:"ul"},"You will first need to ",(0,r.kt)("a",{parentName:"li",href:"https://www.mongodb.com/cloud/atlas/register"},"create an account")," with MongoDB Atlas (this is free, and just requires that you enter basic contact details and acknowledge their terms of service)"),(0,r.kt)("li",{parentName:"ul"},"After logging in, you'll be taken to the ",(0,r.kt)("a",{parentName:"li",href:"https://cloud.mongodb.com/v2"},"home")," screen:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Build a Cluster")," button in the Clusters Overview section.\n",(0,r.kt)("img",{alt:"Create a cluster on MongoDB Atlas.",src:n(69305).Z,width:"842",height:"623"})),(0,r.kt)("li",{parentName:"ul"},"This will open the ",(0,r.kt)("em",{parentName:"li"},"Create New Cluster")," screen.\n",(0,r.kt)("img",{alt:"Choose a cloud provider when using MongoDB Atlas.",src:n(85046).Z,width:"893",height:"789"}),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Select any provider from the ",(0,r.kt)("em",{parentName:"li"},"Cloud Provider & Region")," section. Different providers offer different regions."),(0,r.kt)("li",{parentName:"ul"},'Select any region marked "FREE TIER AVAILABLE".'),(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Create Cluster")," button (creation of the cluster will take some minutes)."))),(0,r.kt)("li",{parentName:"ul"},"You will return to the ",(0,r.kt)("em",{parentName:"li"},"Cluster Overview")," screen.\n",(0,r.kt)("img",{alt:"Setup a collection on MongoDB Atlas.",src:n(40644).Z,width:"995",height:"535"}),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Collections")," button."))),(0,r.kt)("li",{parentName:"ul"},"This will open the ",(0,r.kt)("em",{parentName:"li"},"Collections")," section.\n",(0,r.kt)("img",{alt:"Create a database on MongoDB Atlas.",src:n(3103).Z,width:"993",height:"552"}),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Create Database")," button."))),(0,r.kt)("li",{parentName:"ul"},"This will open the ",(0,r.kt)("em",{parentName:"li"},"Create Database")," screen.\n",(0,r.kt)("img",{alt:"Details during database creation on MongoDB Atlas.",src:n(89372).Z,width:"416",height:"441"}),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Enter the name for the new database as ",(0,r.kt)("inlineCode",{parentName:"li"},"public"),"."),(0,r.kt)("li",{parentName:"ul"},"Enter the name of the collection as ",(0,r.kt)("inlineCode",{parentName:"li"},"Collection0"),"."),(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Create")," button to create the database."))),(0,r.kt)("li",{parentName:"ul"},"You will return to the ",(0,r.kt)("em",{parentName:"li"},"Collection")," screen with your database created.\n",(0,r.kt)("img",{alt:"Database creation confirmation on MongoDB Atlas.",src:n(43944).Z,width:"1176",height:"484"}),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("em",{parentName:"li"},"Overview")," tab to return the cluster overview."))),(0,r.kt)("li",{parentName:"ul"},"From the Cluster0 Overview screen click the ",(0,r.kt)("strong",{parentName:"li"},"Connect")," button.\n",(0,r.kt)("img",{alt:"Configure a connection when after setting up a cluster in MongoDB Atlas.",src:n(75084).Z,width:"1226",height:"509"})),(0,r.kt)("li",{parentName:"ul"},"This will open the Connect to Cluster screen.\n",(0,r.kt)("img",{alt:"Setup a connection when using MongoDB Atlas.",src:n(72384).Z,width:"690",height:"771"}),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Add a Different IP Address")," button, enter ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.0.0/0")," for the IP Address and click ",(0,r.kt)("strong",{parentName:"li"},"Add IP Address")," button.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: It is a best practice to limit the IP addresses that can connect to your database and other resources. Here we allow a connection from anywhere because we don't know where the request will come from after deployment."))),(0,r.kt)("li",{parentName:"ul"},"Enter a username and password and click ",(0,r.kt)("strong",{parentName:"li"},"Create MongoDB User")," button.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: Avoid using special characters in your MongoDB user password as mongoose may not parse the connection string properly."))),(0,r.kt)("li",{parentName:"ul"},"If you have completed the 2 previous steps, the button ",(0,r.kt)("strong",{parentName:"li"},"Choose a connection method")," will turn green."),(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Choose a connection method")," button."))),(0,r.kt)("li",{parentName:"ul"},"This will access the ",(0,r.kt)("em",{parentName:"li"},"Choose a connection method")," tab.\n",(0,r.kt)("img",{alt:"Choose a connection type when connecting with MongoDB Atlas.",src:n(4158).Z,width:"691",height:"606"}),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Connect Your Application")," option."))),(0,r.kt)("li",{parentName:"ul"},"This will open the Connect screen.\n",(0,r.kt)("img",{alt:"Choose the Short SRV connection when settinup a connection on MongoDB Atalas.",src:n(23722).Z,width:"693",height:"604"}),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Short SRV connection string")," option to copy the connection string."))),(0,r.kt)("li",{parentName:"ul"},"This will open the connection string URL.\n",(0,r.kt)("img",{alt:"Copy the Short SRV connection string when setting up a connection on MongoDB Atlas",src:n(70434).Z,width:"690",height:"741"}),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Choose ",(0,r.kt)("strong",{parentName:"li"},"Copy")," button to copy the string."),(0,r.kt)("li",{parentName:"ul"},"Save this string somewhere safe."),(0,r.kt)("li",{parentName:"ul"},"Update the password with your users password."),(0,r.kt)("li",{parentName:"ul"},"Replace test with ",(0,r.kt)("inlineCode",{parentName:"li"},"public"),"."))),(0,r.kt)("li",{parentName:"ul"},"You have now created the database, and have an URL (with username and password) that can be used to access it. This will look something like: ",(0,r.kt)("inlineCode",{parentName:"li"},"mongodb+srv://your_user_name:your_password@cluster0-mbdj7.mongodb.net/public?retryWrites=true"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"DO NOT COMMIT THE VALUE TO GIT"),". Since this contains a secret (the user and password in the connection string), it is best practice to leverage enviroment variables.")))),(0,r.kt)("h2",{id:"resources"},"Resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction"},"Getting Started on Heroku with Node.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://devcenter.heroku.com/articles/deploying-nodejs"},"Deploying Node.js Apps on Heroku")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/mongoose"},"MDN Using a Database (with Mongoose)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/deployment"},"MDN Deploying to production"))))}h.isMDXComponent=!0},4158:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_ChooseAConnectionMethod-55a0e4f6139d25b0bc9c1f03be6c70c1.jpg"},85046:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_ChooseProviderRegion-a4650c21812a5a69dd02fef897f5850f.jpg"},72384:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_ConnectCluster-27d947949795d4b5aff9d35f7d63d92d.jpg"},23722:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_ConnectForShortSRV-302eabc968e9b06b4b507e0e826d99a0.jpg"},75084:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_Connectbutton-d2225e6db24fa070ac68ea153cbf3790.jpg"},70434:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_CopyShortSRV-ce9adc59d8548e7efb8411a96cbcdd7e.jpg"},69305:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_CreateCluster-89b2342fdd9b0479ee1153aa24da16ca.jpg"},40644:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_CreateCollection-aa95e616c19e46da51d3ef556e821277.jpg"},3103:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_CreateDatabase-6dd797f31b94c5bb817c11959ae509bf.jpg"},43944:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_DatabaseCreated-275d2c7e975f07b419ce49ca4ec9b91b.jpg"},89372:function(e,t,n){t.Z=n.p+"assets/images/MongoDB_Atlas_-_DatabaseDetails-1653829fc885037370f6fa141dd606f3.jpg"}}]);